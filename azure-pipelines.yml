# ============================================================
# Pipeline with explicit dependency stages + diagnostics
# ============================================================

stages:

- stage: D
  displayName: "D"

  condition: succeeded()   
  jobs:
    - job: job_D
      displayName: "Execute Job-D"
      pool:
        name: 'test-windows-vm'
      steps:
        # Diagnostics for dependency results visible to this stage
        - script: |
            echo "D completed..."
            echo "Job D completed..."

- stage: C
  displayName: "C"
  condition: and(succeeded(), false)
  jobs:
    - job: job_C
      displayName: "Execute Job-C"
      pool:
        name: 'test-windows-vm'
      steps:
        - script: |
            echo "C completed..."
            echo "Job C completed..."
          
          displayName: "Begin Job C to fail (announce intent)"
        - powershell: |
            Write-Host "Forcing build failure to test downstream dependency behavior..."
            throw "Intentional build failure"
          displayName: "Force failure"
          failOnStderr: true
- stage: B
  displayName: "B"
  dependsOn:
    - C
  condition: succeeded()   
  jobs:
    - job: job_B
      displayName: "Execute Job-B"
      pool:
        name: 'test-windows-vm'
      steps:
        # Diagnostics for dependency results visible to this stage
        - script: |
            echo "B completed..."
            echo "Job B completed...""

- stage: A
  displayName: "A"
  dependsOn:
    - C
  condition: in(dependencies.C.result, 'Succeeded', 'SucceededWithIssues', 'Skipped')

  jobs:
    - job: job_A
      displayName: "Execute job-A"
      pool:
        name: 'test-windows-vm'
      steps:
        - script: |
            echo "A completed..."
            echo "Job A completed...""
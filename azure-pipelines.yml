
# ============================================================
# Pipeline excerpt with dependency result diagnostics
# ============================================================

stages:

# -------------------------------
# Stage 1: UI Placeholder
# -------------------------------
- stage: UI_Placeholder2
  displayName: "UI Placeholder"
  jobs:
    - job: ui_placeholder_job
      displayName: "Run UI placeholder steps"
      pool:
        name: 'test-windows-vm'
      steps:
        - script: |
            echo "UI placeholder work begins..."
            echo "UI placeholder completed."
          displayName: "Execute UI placeholder"

# -------------------------------
# Stage 2: Windows 2025 Single PI Server AF2 Tests
# -------------------------------
- stage: run_tests_SinglePIServerAF2_windows2025
  displayName: "Test: Win25 Single PI Server AF2"
  dependsOn:
    - UI_Placeholder2
  jobs:
    - job: run_tests_win25_job
      displayName: "Run Windows 2025 tests"
      pool:
        name: 'test-windows-vm'   # use your Windows Server 2025/self-hosted agent as needed
      steps:
        - powershell: |
            Write-Host "Starting tests on Windows 2025 Single PI Server AF2..."
            # Replace with real test command(s)
            Write-Host "Simulating tests complete."
          displayName: "Execute AF2 tests (Win2025)"

# -------------------------------
# Stage 3: Delete Domain Controller
# -------------------------------
- stage: delete_domain_controller
  displayName: "Delete Domain Controller"
  dependsOn:
    - UI_Placeholder2
    - run_tests_SinglePIServerAF2_windows2025
    # If you later add Win22/Win19 stages, include them here:
    # - run_tests_SinglePIServerAF2_windows2022
    # - run_tests_SinglePIServerAF2_windows2019

  # Only run when all dependencies succeeded (or succeeded with issues)
  condition: succeeded()

  jobs:
    - job: delete_dc_job
      displayName: "Execute Domain Controller deletion"
      pool:
        name: 'test-windows-vm'
      steps:
        # ------------------------------------------------------------
        # Diagnostics: echo dependency results for quick visibility
        # ------------------------------------------------------------
        - script: |
            echo "== Dependency results (as seen by this stage) =="
            echo "UI_Placeholder2: $(dependencies.UI_Placeholder2.result)"
            echo "Win25 Tests    : $(dependencies.run_tests_SinglePIServerAF2_windows2025.result)"
            # Uncomment if/when you add more dependencies:
            # echo "Win22 Tests    : $(dependencies.run_tests_SinglePIServerAF2_windows2022.result)"
            # echo "Win19 Tests    : $(dependencies.run_tests_SinglePIServerAF2_windows2019.result)"
          displayName: "Echo dependency results"

        - script: |
            echo "Starting Domain Controller deletion..."
            # Insert actual deletion logic here (PowerShell/CLI/remoting)
            echo "Domain Controller deletion completed."
          displayName: "Run deletion logic"
